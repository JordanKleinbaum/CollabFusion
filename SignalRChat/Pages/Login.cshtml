@page
@model SignalRChat.Pages.LoginModel
@{
    Layout = "~/Pages/Shared/_LayoutLoggedOut.cshtml";
}

<style>
    .password-toggle-icon {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        cursor: pointer;
    }

        .password-toggle-icon i {
            font-size: 18px;
            line-height: 1;
        }

</style>

@{
    if (ViewData["LoginMessage"] != null)
    {
        <br />
        if (ViewData["LoginMessage"] == "Successfully Logged Out!")
        {
            <h3 class="text-success">@ViewData["LoginMessage"]</h3>
        }
        if (ViewData["LoginMessage"] == "Username and/or Password Incorrect")
        {
            <h3 class="text-danger">@ViewData["LoginMessage"]</h3>
        }
    }

    if (ViewData["LoginMessage"] == null)
    {
        <br />
    }
}

@{
    if (HttpContext.Session.GetString("username") != null)
    {
        <h3>Already Logged In As: @HttpContext.Session.GetString("username")</h3>
        // Log out here
        <form asp-page="Login" asp-page-handler="LogoutHandler">
            <input type="submit" class="btn btn-danger" value="Logout" />
        </form>
    }

    else if (HttpContext.Session.GetString("LoginError") != null)
    {
        <p class="text-danger">@HttpContext.Session.GetString("LoginError")</p>

                // Let the user try login again.
        <br />
        <br />
        <br />
        <div class="row align-items-center">
            <div class="col-md-12 col-lg-6">
                <img src="./images/InOffice.svg" class="img-fluid" />
            </div>
            <div class="col-md-12 col-lg-6">
                <form asp-page="Login">
                    <label>Username:</label>
                    <input asp-for="Username" class="form-control" placeholder="Enter Username" required />
                    <br />
                    <label>Password:</label>
                    <div class="password-wrapper">
                        <input id="myInput" asp-for="Password" class="form-control" type="password" placeholder="Enter Password" required />
                    </div>
                    <br />
                    <input type="submit" class="btn" style="color: white; width: 100%; background-color: #293A7F;" value="Login" asp-route-admin="@Model.Admin" />
                </form>
                <br />
                @* Additional code here if needed *@
            </div>
        </div>

        @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const passwordInput = document.getElementById('myInput');
                const togglePasswordButtons = document.querySelectorAll('.password-wrapper .toggle-password');

                togglePasswordButtons.forEach(function (button) {
                    button.addEventListener('click', function () {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        togglePasswordButtons.forEach(function (btn) {
                            btn.classList.toggle('show-password');
                            btn.classList.toggle('hide-password');
                        });
                    });
                });
            });
        </script>
        }
    }
    else
    {
                // First time loading the page
        <br />
        <br />
        <br />
        <div class="row align-items-center">
            <div class="col-md-12 col-lg-6">
                <img src="./images/InOffice.svg" class="img-fluid" />
            </div>
            <div class="col-md-12 col-lg-6">
                <form asp-page="Login">
                    <label>Username:</label>
                    <input asp-for="Username" class="form-control" placeholder="Enter Username" required />
                    <br />
                    <label>Password:</label>
                    <div class="password-wrapper user-box" style="position: relative;">
                        <input id="password" asp-for="Password" class="form-control" type="password" placeholder="Enter Password" required />
                        <span class="password-toggle-icon"><i class="fas fa-eye-slash"></i></span>
                    </div>
                    <br />
                    <input type="submit" class="btn" style="color: white; width: 100%; background-color: #293A7F;" value="Login" asp-route-admin="@Model.Admin" />
                </form>
                <br />
                @* Additional code here if needed *@
            </div>
        </div>

        @section Scripts {
        <script>
            const passwordField = document.getElementById("password");
            const togglePassword = document.querySelector(".password-toggle-icon i");

            togglePassword.addEventListener("click", function () {
                if (passwordField.type === "password") {
                    passwordField.type = "text";
                    togglePassword.classList.remove("fa-eye-slash");
                    togglePassword.classList.add("fa-eye");
                } else {
                    passwordField.type = "password";
                    togglePassword.classList.remove("fa-eye");
                    togglePassword.classList.add("fa-eye-slash");
                }
            });
        </script>
        }
    }
}



